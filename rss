#!/bin/sh

tmp=$(notify-send -t 2000 "Parsing SubsPlease RSS... Please Wait..." -p)
data=$(curl -s "https://subsplease.org/rss/?r=1080" | tr "<|>" "\n")
name=$(printf "%s" "$data" | sed -nE 's/^\[.*Please\] (.*)/\1/p' | dmenu -l 25 -p "Search anime:")
[ -z "$name" ] && notify-send -u critical "Err.. Query empty" -r $tmp && exit 0
id=$(printf "$name" | sed -n -e 's/.*\[\(.*\)\].*/\1/p')
magnet=$(printf "%s" "$data" | grep "$id%" | sed 's/amp;//g')
setsid -f st -e $HOME/repos_scripts/torrent "$magnet"
